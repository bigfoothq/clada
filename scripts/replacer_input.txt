=== PROCESSED: 2025-06-21 09:20:59 ===
SUCCESS Block 1: Updated /Users/stuart/repos/clada/clada/main/components/edit/main/core/test-unit/test/parse.test.js
SUCCESS Block 2: Updated /Users/stuart/repos/clada/clada/main/components/edit/main/core/test-unit/test/parse.test.js
ðŸš¨ðŸš¨ðŸš¨ ERROR Block 3: 21 matches found in /Users/stuart/repos/clada/clada/main/components/edit/main/core/test-unit/test/parse.test.js - ABORTING ðŸš¨ðŸš¨ðŸš¨
===

Yes, that approach would work and is actually better. The key issue is that `parse.test.js` is importing from a shared module (`xml-to-dom.js`), which violates the test isolation principle.

Looking at the approach you showed, it directly uses `htmlparser2`'s `parseDocument` function, which is what the orchestrator would use internally. This removes the dependency on shared code while still providing the exact same node structure.
/Users/stuart/repos/clada/clada/main/components/edit/main/core/test-unit/test/parse.test.js
Here's the fix:

<<<EXPLANATION>>>
Remove dependency on shared xml-to-dom.js module and use htmlparser2 directly in the test to maintain isolation

<<<FILE>>>
/Users/stuart/repos/clada/clada/main/components/edit/main/core/test-unit/test/parse.test.js

<<<SEARCH>>>
import { parseEdit } from '../../src/parse.js';
import { parseXml } from '../../../../../shared/src/xml-to-dom.js';
<<<REPLACE>>>
import { parseEdit } from '../../src/parse.js';
import { parseDocument } from 'htmlparser2';
<<<END>>>

<<<EXPLANATION>>>
Add xmlToNode helper function to replace parseXml usage

<<<FILE>>>
/Users/stuart/repos/clada/clada/main/components/edit/main/core/test-unit/test/parse.test.js

<<<SEARCH>>>
import { parseEdit } from '../../src/parse.js';
import { parseDocument } from 'htmlparser2';

describe('parseEdit', () => {
<<<REPLACE>>>
import { parseEdit } from '../../src/parse.js';
import { parseDocument } from 'htmlparser2';

/**
 * Parse XML string to node using htmlparser2
 * Matches how orchestrator will provide nodes
 */
function xmlToNode(xml) {
  const dom = parseDocument(xml, { xmlMode: true });
  // Find first element node (skip text nodes)
  return dom.children.find(child => child.type === 'tag');
}

describe('parseEdit', () => {
<<<END>>>

<<<EXPLANATION>>>
Replace all parseXml(xml).children[0] calls with xmlToNode(xml)

<<<FILE>>>
/Users/stuart/repos/clada/clada/main/components/edit/main/core/test-unit/test/parse.test.js

<<<SEARCH>>>
    const node = parseXml(xml).children[0];
<<<REPLACE>>>
    const node = xmlToNode(xml);
<<<END>>>

This change makes the test self-contained and removes the cross-component dependency, which aligns with the CDD principle of isolated testing.