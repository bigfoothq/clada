=== PROCESSED: 2025-06-24 11:00:45 ===
SUCCESS Block 1: Overwrote /Users/stuart/repos/clada/clada/main/components/run/main/core/doc/ABSTRACT.md
===

<<<EXPLANATION>>>
Expanding ABSTRACT.md to provide a complete high-level overview of all critical components while staying concise

<<<FILE>>>
clada/main/components/run/main/core/doc/ABSTRACT.md

<<<OVERWRITE>>>
# Run Component

## Purpose
Executes shell commands from CSL `RUN` blocks using a two-tier security model that prevents shell injection while allowing controlled filesystem access. Designed for LLM-generated commands where mistakes are expected but malicious intent is not.

## Overview

### Two-Tier Security Model
1. **Filesystem commands**: Hardcoded whitelist in `COMMAND_SPECS` including `cat`, `ls`, `grep`, `find`, `git`, etc. These execute immediately without prompts.
2. **Test commands**: Everything else (e.g., `npm test`, `pytest`, `jest`) requires user approval on first use.

### Approval System
- Unknown commands prompt user: "Allow 'npm test'? (yes/no/always/never):"
- `yes` - Run once only
- `always` - Run and save to `.clada/allowed-commands.json`
- `no` - Don't run
- `never` - Don't run and save to `.clada/blocked-commands.json`
- Previously approved/blocked commands skip prompts

### Command Execution
- **Parser**: `shell-quote` handles proper argument parsing and quote handling
- **Validation**: Rejects shell operators (pipes, redirects), validates paths stay within working directory
- **Execution**: `execFile` only - no shell interpretation prevents injection attacks
- **Limits**: 5 second timeout, 10MB max output per command
- **Special handling**: Git subcommands have their own validation rules

### Error Handling
- Invalid shell syntax
- Disallowed commands or git subcommands
- Path traversal attempts
- Failed execution (non-zero exit codes)
- Timeouts and oversized output

See `concepts/LLM_COMMANDS_APPROACH.md` for detailed implementation and security rationale.
<<<END>>>